---
title: "data_1_tidy"
author: "Liu Chi Yun"
date: "2021/4/2"
output: html_document
---

```{r}
library(tidyverse)
library(httr)
library(jsonlite)
library(keyring)
```


```{r}
# data input via API
data_in <- GET(url = "https://data.cdc.gov/api/views/hk9y-quqm/rows.json?accessType=DOWNLOAD", apikey = key_get("datagov_API_KEY_SECURE"))
status_code(data_in)
```

```{r}
# data input via API
url_input <- "https://data.cdc.gov/api/views/hk9y-quqm/rows.json?accessType=DOWNLOAD"
# convert and tidy interest data into a tibble
json_data <- fromJSON(url_input, flatten = TRUE)
glimpse(json_data)

df_covid <- as_tibble(json_data$data) # as.tibble
df_covid %>% 
  select(-c(V1:V8)) %>% 
  rename(data_as_of = `V9`, start_date = `V10`, end_data = `V11`, group = `V12`, year = `V13`, month = `V14`, state = `V15`, condition_group = `V16`, condition = `V17`, icd10_codes = `V18`, age_group = `V19`, covid_19_deaths = `V20`, number_of_mentions = `V21`, flag = `V22`) -> df_covid
df_covid
```















